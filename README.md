# 92hm-eBook - 漫画下载工具

92hm-eBook 是一个用于从 92hm.life 网站下载漫画的工具，支持下载单个章节或整个漫画系列，并可以将下载的章节打包为标准的CBZ格式或整合为单一电子书文件。

## 功能特点

- 下载单个漫画章节
- 下载整个漫画系列
- 从指定章节开始下载
- 智能文件组织结构（所有内容保存在以漫画命名的主目录下）
- 将下载的章节打包为CBZ格式以便阅读
- 将整个漫画打包为带目录的单一电子书文件
- 支持代理设置
- 自动处理网页压缩格式（gzip, Brotli）
- 智能重试机制
- 支持从本地HTML文件读取内容进行测试

## 安装

确保已安装 Go 1.16 或更高版本。

```bash
# 克隆仓库
git clone <repository-url>
cd 92hm-eBook

# 编译主程序
go build -o 92hm-eBook .

# 编译打包工具
go build -o pack tools/pack.go
go build -o ebook tools/ebook.go
```

## 使用方法

### 下载漫画

#### 下载单个章节
```bash
# 下载章节 16124
./92hm-eBook 16124

# 使用代理下载
export https_proxy=http://127.0.0.1:7897 http_proxy=http://127.0.0.1:7897 all_proxy=socks5://127.0.0.1:7897
./92hm-eBook 16124

# 从本地 HTML 文件下载单章节（测试用）
./92hm-eBook --local hm_page.html
```

#### 下载整个漫画系列
```bash
# 下载漫画系列 418 的所有章节
./92hm-eBook --series 418

# 从章节 16130 开始下载漫画系列 418
./92hm-eBook --series 418 --start 16130

# 从本地目录文件下载整个漫画系列（测试用）
./92hm-eBook --local-series sample_toc.html
```

#### 调试模式
```bash
# 使用调试模式查看更多详细信息
./92hm-eBook --debug 16124
```

### 文件组织结构

下载完成后，文件将按以下结构组织：

```
./
└── 秘密教學/                     # 漫画主目录（以漫画标题命名）
    ├── 001_第1話-門縫傳出呻吟聲/     # 章节目录（序号+章节标题）
    │   ├── 0001.jpg
    │   ├── 0002.jpg
    │   └── ...
    ├── 002_第2話-你要學學看嗎?/
    │   ├── 0001.jpg
    │   ├── 0002.jpg
    │   └── ...
    └── ...
```

这种方式使得：
1. 所有相关内容都组织在以漫画命名的主目录下
2. 章节按顺序编号并使用描述性名称
3. 易于查找和管理

### 打包为CBZ格式

下载完成后，可以使用打包工具将各章节分别打包为CBZ格式，便于在漫画阅读器中阅读。

```bash
# 打包单个章节
./pack "秘密教學"/001_第1話-門縫傳出呻吟聲

# 批量打包所有章节
./pack "秘密教學"/*

# 指定输出目录
./pack -o /path/to/output "秘密教學"/*
```

生成的CBZ文件可以使用以下漫画阅读器打开：
- CDisplayEx (Windows/macOS)
- ComicGlass (iOS)
- Chunky Comic Reader (Android/iOS)
- MComix (Linux)

### 打包为单一电子书

还可以使用电子书工具将整个漫画打包为一个带目录的单一电子书文件：

```bash
# 将整个漫画打包为单一电子书
./ebook "秘密教學"
```

这将生成一个名为 `秘密教學.cbz` 的文件，其中包含：
- 所有章节的图片
- 交互式目录页面 (toc.html)
- 漫画信息文件 (comic.json)

## 注意事项

1. 章节ID是从漫画网站URL中提取的数字部分
   - 例如：`https://www.92hm.life/chapter/16124` 中的 `16124`
   
2. 漫画ID也是从URL中提取的数字部分
   - 例如：`https://www.92hm.life/book/418` 中的 `418`

3. 如果遇到网络问题，请确保正确设置了代理环境变量

4. 由于网站可能采用反爬虫机制，建议适当控制下载频率

5. 当下载整个漫画系列时，程序会自动从目录页面提取漫画标题作为主目录名

## 技术细节

- 使用 Go 语言开发，具有良好的性能和跨平台支持
- 使用 goquery 库解析 HTML 内容
- 支持 gzip 和 Brotli 压缩格式
- 自动处理图片的 gzip 压缩
- 实现了重试机制和超时控制